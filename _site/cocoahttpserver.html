<!DOCTYPE html>
<html>
<head>
    <!--
    * Author:         BeiYuu
    -->
    <meta charset="utf-8" />
    <title>CocoaHTTPServer的简单实用 | NatsuZone.com</title>
    <meta name="author" content="Natsu" />
    <meta name="renderer" content="webkit">
    <meta name="description" content="Natsu's Blog" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <link rel="stylesheet" href="/css/default.css" type="text/css" />
    <link rel="shortcut icon" href="/favicon.png" type="image/png" />
    <link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/atom.xml" />
    <script src="/js/jquery-1.7.1.min.js" type="text/javascript"></script>
</head>
<body>

    <div class="home-menu">
        <div class="home-icon-con">
            <a class="home-menu-icon" href="/">Natsu</a>
            <a class="home-follow" href="#" title="Contact Me">+</a>
        </div>
        <div class="home-contact">
            <a href="http://weibo.com/1720433822" target="_blank" style="margin-left:-5px;"><img src="http://www.weibo.com/favicon.ico" alt="" width="25"/></a>
            <a href="https://github.com/moenatsu" target="_blank" style="text-align:center;"><img src="https://github.com/fluidicon.png" alt="" width="25"/></a>
<!--            <a href="http://instagram.com/beiyuu/" target="_blank" style="text-align:right"><img src="http://d36xtkk24g8jdx.cloudfront.net/bluebar/00c6602/images/ico/favicon.ico" alt="" width="22"/></a>-->
        </div>
    </div>

    <link rel="stylesheet" href="/js/prettify/prettify.css" />
<style type="text/css">
    body { background:#e8e8e8; }
    @media screen and (max-width: 750px){
        body { background:#fff; }
    }
    @media screen and (max-width: 1020px){
        body { background:#fff; }
    }
</style>

<div id="content">
    <div class="entry">
        <h1 class="entry-title"><a href="/cocoahttpserver" title="CocoaHTTPServer的简单实用">CocoaHTTPServer的简单实用</a></h1>
        <p class="entry-date">2016-07-06</p>
        <h2 id="section">简介</h2>
<p><a href="https://github.com/robbiehanson/CocoaHTTPServer">CocoaHTTPServer</a>是Mac OS X和iOS平台上一个轻量级、可嵌入的HTTP服务器框架。它是一个开源的项目，支持异步socket、ipv4、ipv6以及SSL/TLS加密。</p>

<p>使用CocoaHTTPServer框架，可以在iOS设备上建立一个本地服务器，当电脑和移动设备处于同一局域网时，就可以通过电脑访问iOS的服务器页面，并能够实现文件之间的传输。</p>

<h2 id="section-1">使用</h2>
<p>可使用cocoapods快速集成CocoaHTTPServer到项目中。</p>

<pre><code>pod 'CocoaHTTPServer'
</code></pre>

<p>也可以手动导入，手动导入步骤如下：</p>

<p>1.下载<a href="https://github.com/robbiehanson/CocoaHTTPServer">CocoaHTTPServer</a></p>

<p>2.将CocoaHTTPServer-master目录下的Core导入工程。</p>

<p>3.打开Vendor，将其中的CocoaAsyncSocket、CocoaLumberjack文件夹导入。</p>

<p>开启服务器的代码如下：</p>

<pre><code>- (void)openHttpServer {
    self.httpServer = [[HTTPServer alloc] init];
    [self.httpServer setType:@"_http._tcp."];  // 设置服务类型
//    [self.httpServer setPort:12345]; // 设置服务器端口
    NSString *webPath = [[[NSBundle mainBundle] resourcePath] stringByAppendingPathComponent:@"Web"];
    
    NSLog(@"-------------\nSetting document root: %@\n", webPath);
    // 设置服务器路径
    [self.httpServer setDocumentRoot:webPath];
    NSError *error;
    if(![self.httpServer start:&amp;error])
    {
        NSLog(@"-------------\nError starting HTTP Server: %@\n", error);
    }
    else {
        NSLog(@"port %hu",[self.httpServer listeningPort]);
        
    }
}
</code></pre>

<p>获取设备的ip地址的方法如下：</p>

<pre><code>+ (NSString *)deviceIPAdress {
    NSString *address = @"an error occurred when obtaining ip address";
    struct ifaddrs *interfaces = NULL;
    struct ifaddrs *temp_addr = NULL;
    int success = 0;
    
    success = getifaddrs(&amp;interfaces);
    
    if (success == 0) { // 0 表示获取成功
        
        temp_addr = interfaces;
        while (temp_addr != NULL) {
            if( temp_addr-&gt;ifa_addr-&gt;sa_family == AF_INET) {
                // Check if interface is en0 which is the wifi connection on the iPhone
                if ([[NSString stringWithUTF8String:temp_addr-&gt;ifa_name] isEqualToString:@"en0"]) {
                    // Get NSString from C String
                    address = [NSString stringWithUTF8String:inet_ntoa(((struct sockaddr_in *)temp_addr-&gt;ifa_addr)-&gt;sin_addr)];
                }
            }
            
            temp_addr = temp_addr-&gt;ifa_next;
        }
    }
    
    freeifaddrs(interfaces);
    return address;
}
</code></pre>

<p>运行程序后，同一局域网的设备即可通过ip:port访问该设备的指定文件。</p>

<p>如果想要通过其他设备传输文件到本设备上，可参考如下操作：</p>

<p>1.打开Samples/SimpleFileUploadServer文件夹，将其中的MyHTTPConnection类文件、Web文件夹导入工程。</p>

<p>2.在MyHTTPConnection.m的<code>- (void) processStartOfPartWithHeader:(MultipartMessageHeader*) header</code>方法中，将<code>uploadDirPath</code>改为你想要在iOS设备中存放接收的文件的位置即可。</p>

<p>3.在之前的<code>- (void)openHttpServer</code>方法中添加如下代码：</p>

<pre><code>[self.httpServer setConnectionClass:[MyHTTPConnection class]];
</code></pre>

<p>运行程序，同一局域网的设备访问ip:port将会看到如下界面：</p>

<p><img src="/images/cocoahttpserver/uploadfile.png" alt="uploadfile" /></p>

<p>选取文件点击<code>submit</code>之后，就可以将文件传输到上面<code>uploadDirPath</code>指定的路径下面。</p>

<p>该页面显示的就是Web文件夹下的index.html，可根据需要自行更改。</p>


        <br/>
        <br/>
        <hr/>
        <!-- 多说评论框 start -->
        <div class="ds-thread" data-thread-key="/cocoahttpserver" data-title="CocoaHTTPServer的简单实用" data-url="/cocoahttpserver"></div>
        <!-- 多说评论框 end -->
        <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
        <script type="text/javascript">
            var duoshuoQuery = {short_name:"natsu"};
            (function() {
             var ds = document.createElement('script');
             ds.type = 'text/javascript';ds.async = true;
             ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
             ds.charset = 'UTF-8';
             (document.getElementsByTagName('head')[0]
              || document.getElementsByTagName('body')[0]).appendChild(ds);
             })();
        </script>
        <!-- 多说公共JS代码 end -->
    </div>
    
    <div class="sidenav">
        <iframe width="100%" height="75" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=75&fansRow=2&ptype=1&speed=0&skin=5&isTitle=0&noborder=0&isWeibo=0&isFans=0&uid=1720433822&verifier=f6339243&dpc=1"></iframe>
    </div>

    <div class="sidenav">
        <h2>Blog</h2>
        <ul class="artical-list">
        
            <li><a href="/cocoahttpserver">CocoaHTTPServer的简单实用</a></li>
        
            <li><a href="/arc-leak">在ARC下调用performSelector方法导致的内存泄露问题</a></li>
        
            <li><a href="/apache-php-mysql">在OSX 10.11 EI Capitan中运行Apache，MySQL，PHP和phpMyAdmin</a></li>
        
            <li><a href="/mac-command-line">Mac终端使用Tips</a></li>
        
            <li><a href="/mac-ruby">如何在Mac终端升级ruby版本【转】</a></li>
        
            <li><a href="/github-pages">使用Github Pages建独立博客</a></li>
        
        </ul>

        <h2>Opinion</h2>
        <ul class="artical-list">
        
            <li><a href="/talk">杂谈</a></li>
        
        </ul>

        <h2>Project</h2>
        <ul class="artical-list">
        
            <li><a href="/city-pickview">城市选择器</a></li>
        
        </ul>
    </div>
</div>



<script src="/js/post.js" type="text/javascript"></script>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1259284578'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s95.cnzz.com/z_stat.php%3Fid%3D1259284578%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));
</script>



    <script type="text/javascript">
        $(function(){
            $('.home-follow').click(function(e){
                e.preventDefault();

                if($('.home-contact').is(':visible')){
                    $('.home-contact').slideUp(100);
                }else{
                    $('.home-contact').slideDown(100);
                }
            });
        })
    </script>
    <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1259284578'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s95.cnzz.com/z_stat.php%3Fid%3D1259284578%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));
    </script>
</body>
</html>
